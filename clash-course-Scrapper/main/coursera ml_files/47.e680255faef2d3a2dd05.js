(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{"jq+c":function(module,e,t){"use strict";t.r(e);var n=t("VbXa"),r=t.n(n),a=t("q1tI"),s=t.n(a),o=t("S+eF"),i=t.n(o),c=t("DnuM"),u=t("sQ/U"),l=t("hs7e"),d=t("fw5G"),h=t.n(d),m=t("15pW"),p=t("TSOT"),g=Object(p.a)(m.a.openCourseMembershipApi,{type:"rest"}),membershipsData=function(e){var t=(new h.a).addQueryParam("q","findByUser").addQueryParam("userId",e);return i()(g.get(t.toString()))},f=t("welz"),v=t.n(f),E=t("vlZc"),L=t.n(E),y=t("F/us"),w=t.n(y),C=t("qiY+"),b,R=L.a.AssociatedModel.extend({api:g,defaults:function defaults(){return{timestamp:Date.now()}},initialize:function initialize(e){if(!w()(e).has("courseId"))throw new Error("You must instantiate a Membership with a courseId");this.get("userId")||this.set("userId",e.userId||u.a.get().id),w()(e).has("id")||this.set("id",this.get("userId")+"~"+this.get("courseId"),{silent:!0})},hasTeachingRole:function hasTeachingRole(){return w()(m.a.courseRolesWithTeachAccess).contains(this.get("courseRole").toUpperCase())},hasModerationRole:function hasModerationRole(){return w()(m.a.courseRolesWithModeratorAccess).contains(this.get("courseRole").toUpperCase())},hasEnrolledRole:function hasEnrolledRole(){return!w()([C.a.BROWSER,C.a.NOT_ENROLLED,C.a.PRE_ENROLLED_LEARNER]).contains(this.get("courseRole"))},hasPreEnrolled:function hasPreEnrolled(){return this.get("courseRole")===C.a.PRE_ENROLLED_LEARNER},enroll:function enroll(e){this.set("courseRole",e||C.a.LEARNER);var t={data:this.toJSON()};return i()(this.api.post("",t))},unenroll:function unenroll(){return this.set("courseRole",C.a.NOT_ENROLLED),i()(this.api.delete(this.get("id")))}},C.a),T,N=v.a.Collection.extend({model:R,getEnrolled:function getEnrolled(){return this.filter((function(e){return e.get("courseRole")!==R.NOT_ENROLLED}))}}),promises_memberships=function(e){var t=membershipsData(e).then((function(e){return new N(e.elements)}));return t.done(),t},k=t("8li0"),B=Object(c.a)("/api/reports.v1",{type:"rest"}),A="teachVisitedAt",D=10080,W={getBannerData:function getBannerData(){var e=this;return this.getTeachingCourse().spread((function(t,n){return[t,n,e.getLearnerCounts(t,n)]}))},getVisitedTimestamp:function getVisitedTimestamp(){return localStorage.teachVisitedAt},setVisitedTimestamp:function setVisitedTimestamp(){localStorage.teachVisitedAt=Date.now()},shouldShow:function shouldShow(){var e=this.getVisitedTimestamp();if(e){var t=new Date(parseInt(e)),n=new Date(Date.now()),r,a,s;return 60*n.getHours()+n.getMinutes()-(60*t.getHours()+t.getMinutes())>10080}return!0},getTeachingCourse:function getTeachingCourse(){var e=u.a.get().id;if(!e)return i.a.reject();return promises_memberships(e).then((function(e){var t=e.find((function(e){return e.hasTeachingRole()}));if(t&&"UNIVERSITY_ADMIN"!==t.get("courseRole")){var n=t.get("courseId");return[t,l.a.fromId(n)]}return i.a.reject()})).spread((function(e,t){return k.a.isLaunched(t)?[e,t]:i.a.reject()}))},getLearnerCounts:function getLearnerCounts(e,t){var n=this;return i()(B.get("Course~".concat(t.id,"~activity_learner_counts"))).then((function(r){return n.validateLearnerCountsResponse(r)?r.elements[0].body:i.a.reject({membership:e,course:t})}))},validateLearnerCountsResponse:function validateLearnerCountsResponse(e){return e.elements&&e.elements[0]&&e.elements[0].body&&e.elements[0].body.latest&&e.elements[0].body.latest.starter_ever_count&&e.elements[0].body.latest.active_learner_past_1w_count&&e.elements[0].body.latest.visitor_ever_count&&e.elements[0].body["1w_ago"]&&e.elements[0].body["1w_ago"].starter_ever_count},getWeeklyNewLearnerCount:function getWeeklyNewLearnerCount(e){return e.latest.starter_ever_count-e["1w_ago"].starter_ever_count},getWeeklyActiveLearnerCount:function getWeeklyActiveLearnerCount(e){return e.latest.active_learner_past_1w_count},getTotalLearnerCount:function getTotalLearnerCount(e){return e.latest.visitor_ever_count}},I=W,V=W.getBannerData,M=W.getVisitedTimestamp,S=W.setVisitedTimestamp,j=W.shouldShow,O=W.getTeachingCourse,q=W.getLearnerCounts,x=W.validateLearnerCountsResponse,P=W.getWeeklyNewLearnerCount,U=W.getWeeklyActiveLearnerCount,z=W.getTotalLearnerCount,J=t("wab5"),Q=t("17x9"),Y=t.n(Q),F=t("kvW3"),H,G=function(e){function TotalLearnerBanner(){return e.apply(this,arguments)||this}var t;return r()(TotalLearnerBanner,e),TotalLearnerBanner.prototype.render=function render(){var e=this.props.course,t=e.name,n="/teach/".concat(e.slug),r=I.getTotalLearnerCount(this.props.learnerCounts);return s.a.createElement("div",{className:"rc-TotalLearnerBanner"},"A total of"," ",s.a.createElement("a",{href:n},s.a.createElement("strong",{className:"c-teach-banner-learner-count"},s.a.createElement(F.c,{value:r})," learners"))," ","are enrolled in ",s.a.createElement("span",{className:"c-teach-banner-course-name"},t),". View more on the"," ",s.a.createElement("a",{href:n},H||(H=s.a.createElement("strong",null,"Course Dashboard."))))},TotalLearnerBanner}(s.a.Component);G.propTypes={course:Y.a.object.isRequired,learnerCounts:Y.a.object.isRequired};var X=G,Z,K=function(e){function WeeklyActiveLearnerBanner(){return e.apply(this,arguments)||this}var t;return r()(WeeklyActiveLearnerBanner,e),WeeklyActiveLearnerBanner.prototype.render=function render(){var e=this.props.course,t=e.name,n="/teach/".concat(e.slug),r=I.getWeeklyActiveLearnerCount(this.props.learnerCounts);return s.a.createElement("div",{className:"rc-WeeklyActiveLearnerBanner"},s.a.createElement("a",{href:n},s.a.createElement("strong",{className:"c-teach-banner-learner-count"},s.a.createElement(F.c,{value:r})," learners"))," ","were active in ",s.a.createElement("span",{className:"c-teach-banner-course-name"},t)," in the past week. View more on the"," ",s.a.createElement("a",{href:n},Z||(Z=s.a.createElement("strong",null,"Course Dashboard."))))},WeeklyActiveLearnerBanner}(s.a.Component);K.propTypes={course:Y.a.object.isRequired,learnerCounts:Y.a.object.isRequired};var ee=K,te,ne=function(e){function WeeklyNewLearnerBanner(){return e.apply(this,arguments)||this}var t;return r()(WeeklyNewLearnerBanner,e),WeeklyNewLearnerBanner.prototype.render=function render(){var e=this.props.course,t=e.name,n="/teach/".concat(e.slug),r=I.getWeeklyNewLearnerCount(this.props.learnerCounts);return s.a.createElement("div",{className:"rc-WeeklyNewLearnerBanner"},s.a.createElement("a",{href:n},s.a.createElement("strong",{className:"c-teach-banner-learner-count"},s.a.createElement(F.c,{value:r})," learners"))," ","enrolled in ",s.a.createElement("span",{className:"c-teach-banner-course-name"},t)," in the past week. View more on the"," ",s.a.createElement("a",{href:n},te||(te=s.a.createElement("strong",null,"Course Dashboard."))))},WeeklyNewLearnerBanner}(s.a.Component);ne.propTypes={course:Y.a.object.isRequired,learnerCounts:Y.a.object.isRequired};var re,ae,se,oe=[{key:"weeklyActiveLearner",component:ee},{key:"weeklyNewLearner",component:ne},{key:"totalLearner",component:X}],ie=function(e){function TeachBanner(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(t=e.call.apply(e,[this].concat(r))||this).state={course:null,membership:null,learnerCounts:{},bannerIndex:-1,dismissed:!1},t.handleDismiss=function(){I.setVisitedTimestamp(),t.setState({dismissed:!0})},t}r()(TeachBanner,e);var t=TeachBanner.prototype;return t.componentDidMount=function componentDidMount(){var e=this;I.getBannerData().spread((function(t,n,r){var a=Math.round(Math.random()*(oe.length-1));e.setState({course:n,membership:t,learnerCounts:r,bannerIndex:a})})).catch((function(){})).done()},t.renderBanner=function renderBanner(){var e=oe[this.state.bannerIndex].component;return(s.a.createElement(e,{course:this.state.course,learnerCounts:this.state.learnerCounts}))},t.render=function render(){if(!this.state.course||this.state.dismissed||!I.shouldShow())return ae||(ae=s.a.createElement("div",null));return(s.a.createElement("div",{className:"rc-TeachBanner bt3-alert bt3-alert-info bt3-alert-dismissable"},s.a.createElement("div",{className:"c-teach-banner-content"},s.a.createElement("button",{onClick:this.handleDismiss,className:"bt3-close","data-dismiss":"alert","aria-label":"Close"},se||(se=s.a.createElement("span",{"aria-hidden":"true"},"Ã—"))),this.renderBanner())))},TeachBanner}(s.a.Component),ce=e.default=ie},wab5:function(module,exports,e){e("xTv4")},xTv4:function(module,exports,e){}}]);
//# sourceMappingURL=47.e680255faef2d3a2dd05.js.map